(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const i="a75a9620a0fa41d48ddf77bd91b3b49b",d=new URLSearchParams(window.location.search),s=d.get("code");if(!s)u(i);else{const e=await y(i,s);l(e),setInterval(()=>l(e),1e3)}async function u(e){const a=p(128),r=await m(a);localStorage.setItem("verifier",a);const t=new URLSearchParams;t.append("client_id",e),t.append("response_type","code"),t.append("redirect_uri","http://localhost:5173/callback"),t.append("scope","user-read-private user-read-email user-read-currently-playing"),t.append("code_challenge_method","S256"),t.append("code_challenge",r),document.location=`https://accounts.spotify.com/authorize?${t.toString()}`}function p(e){let a="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let t=0;t<e;t++)a+=r.charAt(Math.floor(Math.random()*r.length));return a}async function m(e){const a=new TextEncoder().encode(e),r=await window.crypto.subtle.digest("SHA-256",a);return btoa(String.fromCharCode.apply(null,[...new Uint8Array(r)])).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function y(e,a){const r=localStorage.getItem("verifier"),t=new URLSearchParams;t.append("client_id",e),t.append("grant_type","authorization_code"),t.append("code",a),t.append("redirect_uri","hhttps://ilijakekovic.github.io/SpotifyTrackMe/callback"),t.append("code_verifier",r);const n=await fetch("https://accounts.spotify.com/api/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t}),{access_token:o}=await n.json();return o}async function f(e){const r=await(await fetch("https://api.spotify.com/v1/me/player/currently-playing",{method:"GET",headers:{Authorization:`Bearer ${e}`}})).json();return console.log(r),r}async function g(e){if(!e||!e.item||!e.item.album||!e.item.artists){console.error("Invalid profile data",e);return}const a=e.item.album.images[0]?.url||"",r=e.item.artists.map(c=>c.name).join(", ");e.item.album.images[0]?.url;const t=e.progress_ms||0,n=e.item.duration_ms||0,o=e.context?.href||"";document.getElementById("album-cover").src=a,document.getElementById("artist-names").textContent=r,document.getElementById("timeline").max=n,document.getElementById("timeline").value=t,document.getElementById("playlist-name").textContent=o}async function l(e){const a=await f(e);g(a)}
